// update with `op item get men6qzmzjluxnlsalvuqnm3pxa --format json | bash -c "$(jq -r '"TS_OAUTH_ID=\(.fields[] | select(.label == "client_id") | .value) TS_OAUTH_SECRET=\(.fields[] | select(.label == "client_secret") | .value) TS_TAILNET=pluralkit.org.github nix run nixpkgs#go -- run tailscale.com/cmd/gitops-pusher@66aa77416744037baec93206ae212012a2314f83 --policy-file=tailscale-acls.json"') test"`

{
	"groups": {
		"group:admins": ["u1f408@github", "avioletheart@github", "asleepyskye@github"],
		"group:devs":   ["rladenson@github"],
	},

	"tagOwners": {
		"tag:prod":          [],
		"tag:k8s-cp":        [],
		"tag:flyio":         [],
		"tag:edge":          [],
		"tag:oob":           [],
		"tag:o11y":          [],
		"tag:fly-telemetry": [],
	},

	"hosts": {},

	"autoApprovers": {
		"routes": {
			"fdaa:9:e856:0:1::/80": ["tag:flyio"],
			"fdaa::3/128":          ["tag:flyio"],
			"10.20.0.0/16":         ["tag:prod"],
			"10.21.21.0/24":        ["tag:prod"]
		},
	},

	"acls": [
		{"action": "accept", "src": ["*"], "dst": ["autogroup:self:*"]},
		{"action": "accept", "src": ["group:admins"], "dst": ["*:*"]},

		{"action": "accept", "src": ["tag:prod"], "dst": ["tag:prod:*"]},
		{"action": "accept", "src": ["tag:prod"], "dst": ["fdaa:9:e856:0:1::/80:*", "fdaa::3/128:*"]},
		{"action": "accept", "src": ["tag:o11y"], "dst": ["tag:o11y:*"]},
		{"action": "accept", "src": ["tag:fly-telemetry"], "dst": ["tag:o11y:80"]},

		// k8s
		// probably scope this down at some point
		{"action": "accept", "src": ["tag:k8s-cp"], "dst":["tag:prod:*"]},
		{"action": "accept", "src": ["tag:prod"], "dst":["tag:k8s-cp:*"]},
		{"action": "accept", "src": ["tag:prod"], "dst":["10.20.0.0/16:*","10.21.21.0/24:*"]},
		{"action": "accept", "src": ["tag:edge"], "dst":["10.21.21.0/24:*"]},

		// unsure what these are for?
		{"action": "accept", "src": ["tag:prod"], "dst": ["172.17.0.0/16:*"]},
		{"action": "accept", "src": ["tag:prod"], "dst": ["tag:edge:*"]},
		{"action": "accept", "src": ["tag:prod"], "dst": ["tag:o11y:*"]},

		// grafana
		{"action": "accept", "src": ["tag:edge"], "dst": ["100.79.33.60:3000"]},
		// glitchtip
		{"action": "accept", "src": ["tag:edge"], "dst": ["100.79.33.60:8000"]},
		// statuspage
		{"action": "accept", "src": ["tag:edge"], "dst": ["100.79.33.60:5080"]},

		// fly edge -> consul services
		{
			"action": "accept",
			"src":    ["tag:edge"],
			"dst":    ["100.64.0.0/10:*", "fdef::/16:*"],
		}
	],

	"ssh": [
		{
			"action": "accept",
			"src":    ["group:admins"],
			"dst":    ["tag:prod", "tag:oob"],
			"users":  ["autogroup:nonroot", "root"],
		},
		{
			"action": "accept",
			"src":    ["tag:prod"],
			"dst":    ["tag:prod"],
			"users":  ["root"],
		},
	],
	"nodeAttrs": [],
}

// vi: set ft=jsonc:
